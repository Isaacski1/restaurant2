<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1>Simple Admin Dashboard</h1>

        <div class="card mt-4">
            <div class="card-header">
                <h3>All Orders</h3>
                <button onclick="loadOrders()" class="btn btn-primary">Refresh Orders</button>
            </div>
            <div class="card-body">
                <div id="ordersList"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDvpv148pehFCPMwuw1hDYPPnWA67EOHOU",
            authDomain: "isaacski-restaurant.firebaseapp.com",
            projectId: "isaacski-restaurant",
            storageBucket: "isaacski-restaurant.firebasestorage.app",
            messagingSenderId: "793597481997",
            appId: "1:793597481997:web:fce9cb43ca442eee7b7144",
            measurementId: "G-CNYCFT8N3F"
        };

        // Initialize Firebase
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            console.log("✅ Firebase initialized in admin");
        } catch (error) {
            console.error("❌ Firebase initialization error:", error);
        }

        // Load orders function
        async function loadOrders() {
            const ordersList = document.getElementById('ordersList');
            ordersList.innerHTML = '<div class="alert alert-info">Loading orders...</div>';

            try {
                const snapshot = await db.collection('orders').orderBy('timestamp', 'desc').get();

                if (snapshot.empty) {
                    ordersList.innerHTML = '<div class="alert alert-warning">No orders found in database</div>';
                    return;
                }

                let html = `
                    <div class="alert alert-success">
                        Found ${snapshot.size} orders
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Customer</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Location</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                snapshot.forEach(doc => {
                    const order = doc.data();
                    const date = order.timestamp ? order.timestamp.toDate().toLocaleString() : 'No date';

                    html += `
                        <tr>
                            <td>${doc.id.substring(0, 8)}</td>
                            <td>${order.customerName || 'N/A'}</td>
                            <td>${order.customerEmail || 'N/A'}</td>
                            <td>${order.customerPhone || 'N/A'}</td>
                            <td>${order.vendorLocation || 'N/A'}</td>
                            <td>¢${order.totalAmount || 0}</td>
                            <td>
                                <span class="badge bg-${getStatusColor(order.status)}">
                                    ${order.status || 'pending'}
                                </span>
                            </td>
                            <td>${date}</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;

                ordersList.innerHTML = html;

            } catch (error) {
                ordersList.innerHTML = `
                    <div class="alert alert-danger">
                        ❌ Error loading orders: ${error.message}
                    </div>
                `;
                console.error("Error loading orders:", error);
            }
        }

        function getStatusColor(status) {
            const colors = {
                'pending': 'warning',
                'completed': 'success',
                'preparing': 'info',
                'cancelled': 'danger'
            };
            return colors[status] || 'secondary';
        }

        // Load orders on page load
        document.addEventListener('DOMContentLoaded', loadOrders);
    </script>
</body>

</html>