<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Order Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1>Simple Order Test</h1>
        <p>This bypasses Paystack and saves directly to Firebase</p>

        <div class="card mt-4">
            <div class="card-body">
                <form id="simpleOrderForm">
                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="testName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="testEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-control" id="testPhone" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Location</label>
                        <select class="form-control" id="testLocation" required>
                            <option value="central-market">Central Market</option>
                            <option value="swedru-zongo">Swedru Zongo</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-success">Save Order to Firebase</button>
                </form>

                <div id="testResult" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDvpv148pehFCPMwuw1hDYPPnWA67EOHOU",
            authDomain: "isaacski-restaurant.firebaseapp.com",
            projectId: "isaacski-restaurant",
            storageBucket: "isaacski-restaurant.firebasestorage.app",
            messagingSenderId: "793597481997",
            appId: "1:793597481997:web:fce9cb43ca442eee7b7144",
            measurementId: "G-CNYCFT8N3F"
        };

        // Initialize Firebase
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            console.log("‚úÖ Firebase initialized successfully");
        } catch (error) {
            console.error("‚ùå Firebase initialization error:", error);
        }

        // Handle form submission
        document.getElementById('simpleOrderForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const resultDiv = document.getElementById('testResult');
            const button = e.target.querySelector('button');
            const originalText = button.textContent;

            button.textContent = 'Saving...';
            button.disabled = true;
            resultDiv.innerHTML = '<div class="alert alert-info">Saving order...</div>';

            try {
                // Simple order data
                const orderData = {
                    customerName: document.getElementById('testName').value,
                    customerEmail: document.getElementById('testEmail').value,
                    customerPhone: document.getElementById('testPhone').value,
                    vendorLocation: document.getElementById('testLocation').value,

                    // Simple order items
                    mainDish: "Jollof Rice",
                    protein: "Chicken",
                    totalAmount: 25.00,

                    status: 'pending',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    source: 'test-page'
                };

                console.log("üì¶ Order data:", orderData);

                // Save to Firebase using add() to auto-generate ID
                const docRef = await db.collection('orders').add(orderData);

                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        ‚úÖ Order saved successfully!<br>
                        Document ID: ${docRef.id}<br>
                        Order Data: ${JSON.stringify(orderData, null, 2)}
                    </div>
                `;

                console.log("‚úÖ Order saved with ID:", docRef.id);

                // Reset form
                e.target.reset();

            } catch (error) {
                console.error('‚ùå Error saving order:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå Error: ${error.message}<br>
                        Full Error: ${JSON.stringify(error, null, 2)}
                    </div>
                `;
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        });

        // Test Firebase connection
        window.testConnection = async function () {
            try {
                const testData = {
                    test: true,
                    message: "Connection test",
                    timestamp: new Date()
                };

                const docRef = await db.collection('test').add(testData);
                alert(`‚úÖ Firebase connection working! Test document: ${docRef.id}`);
            } catch (error) {
                alert(`‚ùå Firebase error: ${error.message}`);
            }
        };
    </script>

    <div class="container mt-3">
        <button onclick="testConnection()" class="btn btn-info">Test Firebase Connection</button>
    </div>
</body>

</html>